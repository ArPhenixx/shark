tshark -r fichier.pcap -Y '(ip.src==10.0.0.0 || ip.dst==10.0.0.0) && smb' -T fields -e ip.src -e ip.dst -e smb.file | grep '\.exe$' | awk '{print $1 "\t" $2 "\t" $3}' > resultat.txt


tshark -r fichier.pcap -Y '(ip.src==10.0.0.0 || ip.dst==10.0.0.0) && smb' -T fields -e ip.src -e ip.dst -e smb.file | grep '\.exe$' | sort | uniq -c | awk '{print $2 "\t" $3 "\t" $4 "\t" $1}' > resultat.txt

tshark -r fichier.pcap -Y '(ip.src==10.0.0.0 || ip.dst==10.0.0.0) && smb' -T fields -e ip.src -e ip.dst -e smb.fid -e smb.file | grep -v 'ooo' | sort | uniq -c | awk '{print $2 "\t" $3 "\t" $4 "\t" $1}' > resultat.txt


tshark -r fichier.pcap -Y '(ip.src==10.0.0.0 || ip.dst==10.0.0.0) && smb' -T fields -e ip.src -e ip.dst -e smb.fid -e smb.file | grep -v 'ooo' | awk '{split($4, file, "/"); fid = $3 "-" file[length(file)]; print $2 "\t" fid "\t" $5 "\t" $1}' | sort | uniq -c > resultat.




echo -e "IP Source\tIP Destination\tFichier SMB\tNombre de fois" > resultat.txt
tshark -r fichier.pcap -Y '(ip.src==10.0.0.0 || ip.dst==10.0.0.0) && smb' -T fields -e ip.src -e ip.dst -e smb.file | sort | uniq -c | awk '{print $2 "\t" $3 "\t" $4 "\t" $1}' >> resultat.txt


tshark -r fichier.pcap -Y "ntlmssp.challenge.target_info.nb_computer_name" -T fields -e ip.src -e ntlmssp.challenge.target_info.nb_computer_name -e ntlmssp.challenge.target_info.os_version > liste_ntlmssp.txt


echo -e "IP Source\tPort Source\tIP Destination\tPort Destination\tNom de Fichier SMB\tNombre de fois" > resultat.txt
tshark -r fichier.pcap -Y '(ip.src==10.0.0.0 || ip.dst==10.0.0.0) && smb' -T fields -e ip.src -e tcp.srcport -e ip.dst -e tcp.dstport -e smb.file | grep '\.exe$' | sort | uniq -c | awk '{print $2 "\t" $3 "\t" $4 "\t" $5 "\t" $6 "\t" $1}' >> resultat.txt
